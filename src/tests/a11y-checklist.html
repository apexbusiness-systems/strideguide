<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StrideGuide A11y Automated Snapshot</title>
    <style>
        body { font-family: system-ui; margin: 2rem; background: #f8f9fa; }
        .test-section { background: white; padding: 1rem; margin: 1rem 0; border-radius: 8px; border: 1px solid #dee2e6; }
        .pass { color: #28a745; font-weight: bold; }
        .fail { color: #dc3545; font-weight: bold; }
        .warn { color: #ffc107; font-weight: bold; }
        .target-size { display: inline-block; margin: 0.5rem; padding: 0.75rem; border: 2px solid #007bff; border-radius: 4px; min-width: 44px; min-height: 44px; text-align: center; }
        .target-fail { border-color: #dc3545; background: #f8d7da; }
        code { background: #e9ecef; padding: 0.2rem 0.4rem; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>StrideGuide Accessibility Audit Snapshot</h1>
    <p><strong>Generated:</strong> <span id="timestamp"></span></p>
    
    <div class="test-section">
        <h2>üéØ Touch Target Size Validation</h2>
        <p><strong>Standard:</strong> Minimum 44pt (iOS) / 48dp (Android) ‚âà 44px at standard density</p>
        
        <h3>Test Targets (Main Controls)</h3>
        <div id="touch-targets">
            <div class="target-size">Start Guidance</div>
            <div class="target-size">Find Item</div>
            <div class="target-size">Emergency SOS</div>
            <div class="target-size">Settings</div>
            <div class="target-size">Language Toggle</div>
        </div>
        
        <div id="target-results"></div>
    </div>

    <div class="test-section">
        <h2>üîç ARIA & Semantic Check</h2>
        <div id="aria-results">
            <p>Scanning for missing labels and roles...</p>
        </div>
    </div>

    <div class="test-section">
        <h2>üé® Color Contrast Analysis</h2>
        <div id="contrast-results">
            <p>Checking WCAG 2.2 AA compliance...</p>
        </div>
    </div>

    <div class="test-section">
        <h2>‚å®Ô∏è Keyboard Navigation</h2>
        <div id="focus-results">
            <p>Validating focus order and visibility...</p>
        </div>
    </div>

    <div class="test-section">
        <h2>üì± Screen Reader Compatibility</h2>
        <div id="sr-results">
            <p>Checking announcements and live regions...</p>
        </div>
    </div>

    <script>
        // Set timestamp
        document.getElementById('timestamp').textContent = new Date().toISOString();

        // Touch Target Size Validator
        function validateTouchTargets() {
            const results = document.getElementById('target-results');
            const targets = document.querySelectorAll('.target-size');
            let issues = [];

            targets.forEach((target, i) => {
                const rect = target.getBoundingClientRect();
                const minSize = 44; // px
                
                if (rect.width < minSize || rect.height < minSize) {
                    target.classList.add('target-fail');
                    issues.push(`Target ${i+1}: ${rect.width.toFixed(1)}√ó${rect.height.toFixed(1)}px (Too small)`);
                }
            });

            if (issues.length === 0) {
                results.innerHTML = '<p class="pass">‚úÖ All touch targets meet minimum size requirements</p>';
            } else {
                results.innerHTML = '<p class="fail">‚ùå Touch target issues found:</p><ul>' + 
                    issues.map(issue => `<li>${issue}</li>`).join('') + '</ul>';
            }
        }

        // ARIA Validation
        function validateARIA() {
            const results = document.getElementById('aria-results');
            const issues = [];

            // Check buttons without aria-label or accessible text
            const buttons = document.querySelectorAll('button, [role="button"]');
            buttons.forEach((btn, i) => {
                const hasLabel = btn.getAttribute('aria-label') || 
                               btn.getAttribute('aria-labelledby') || 
                               btn.textContent.trim() ||
                               btn.querySelector('img')?.getAttribute('alt');
                
                if (!hasLabel) {
                    issues.push(`Button ${i+1}: Missing accessible name`);
                }
            });

            // Check images without alt text
            const images = document.querySelectorAll('img');
            images.forEach((img, i) => {
                if (!img.getAttribute('alt') && !img.getAttribute('aria-hidden')) {
                    issues.push(`Image ${i+1}: Missing alt text`);
                }
            });

            // Check form inputs without labels
            const inputs = document.querySelectorAll('input, select, textarea');
            inputs.forEach((input, i) => {
                const hasLabel = input.getAttribute('aria-label') ||
                               input.getAttribute('aria-labelledby') ||
                               document.querySelector(`label[for="${input.id}"]`);
                
                if (!hasLabel) {
                    issues.push(`Input ${i+1}: Missing label association`);
                }
            });

            if (issues.length === 0) {
                results.innerHTML = '<p class="pass">‚úÖ All elements have proper ARIA labels</p>';
            } else {
                results.innerHTML = '<p class="fail">‚ùå ARIA issues found:</p><ul>' + 
                    issues.map(issue => `<li>${issue}</li>`).join('') + '</ul>';
            }
        }

        // Color Contrast Check (simplified)
        function checkContrast() {
            const results = document.getElementById('contrast-results');
            const issues = [];

            // Get computed styles for key elements
            const testElements = [
                { selector: 'body', name: 'Body text' },
                { selector: 'button', name: 'Button text' },
                { selector: '.muted-foreground', name: 'Muted text' }
            ];

            testElements.forEach(({ selector, name }) => {
                const element = document.querySelector(selector);
                if (element) {
                    const styles = window.getComputedStyle(element);
                    const color = styles.color;
                    const bgColor = styles.backgroundColor;
                    
                    // Simplified check - in real implementation would calculate contrast ratio
                    if (color === bgColor) {
                        issues.push(`${name}: Same foreground and background color`);
                    }
                }
            });

            if (issues.length === 0) {
                results.innerHTML = '<p class="pass">‚úÖ No obvious contrast issues detected</p>' +
                    '<p class="warn">‚ö†Ô∏è Use axe-core or WAVE for comprehensive contrast analysis</p>';
            } else {
                results.innerHTML = '<p class="fail">‚ùå Contrast issues found:</p><ul>' + 
                    issues.map(issue => `<li>${issue}</li>`).join('') + '</ul>';
            }
        }

        // Focus Management Check
        function validateFocus() {
            const results = document.getElementById('focus-results');
            const issues = [];

            // Check for focusable elements without visible focus
            const focusable = document.querySelectorAll('button, a, input, select, textarea, [tabindex]:not([tabindex="-1"])');
            
            focusable.forEach((element, i) => {
                // Simulate focus to check visibility
                element.focus();
                const styles = window.getComputedStyle(element);
                const outline = styles.outline;
                const outlineWidth = styles.outlineWidth;
                const boxShadow = styles.boxShadow;
                
                // Check if there's visible focus indication
                if (outline === 'none' && outlineWidth === '0px' && boxShadow === 'none') {
                    issues.push(`Element ${i+1}: No visible focus indicator`);
                }
            });

            if (issues.length === 0) {
                results.innerHTML = '<p class="pass">‚úÖ All focusable elements have visible focus indicators</p>';
            } else {
                results.innerHTML = '<p class="fail">‚ùå Focus issues found:</p><ul>' + 
                    issues.map(issue => `<li>${issue}</li>`).join('') + '</ul>';
            }
        }

        // Screen Reader Check
        function validateScreenReader() {
            const results = document.getElementById('sr-results');
            const issues = [];

            // Check for aria-live regions
            const liveRegions = document.querySelectorAll('[aria-live]');
            if (liveRegions.length === 0) {
                issues.push('No aria-live regions found for status announcements');
            }

            // Check for proper heading structure
            const headings = document.querySelectorAll('h1, h2, h3, h4, h5, h6');
            let headingLevels = Array.from(headings).map(h => parseInt(h.tagName.charAt(1)));
            
            for (let i = 1; i < headingLevels.length; i++) {
                if (headingLevels[i] > headingLevels[i-1] + 1) {
                    issues.push(`Heading structure skip: h${headingLevels[i-1]} to h${headingLevels[i]}`);
                    break;
                }
            }

            // Check for landmark regions
            const landmarks = document.querySelectorAll('main, nav, header, footer, aside, section[aria-label], [role="main"], [role="navigation"], [role="banner"], [role="contentinfo"]');
            if (landmarks.length === 0) {
                issues.push('No landmark regions found for navigation');
            }

            if (issues.length === 0) {
                results.innerHTML = '<p class="pass">‚úÖ Screen reader structure looks good</p>';
            } else {
                results.innerHTML = '<p class="warn">‚ö†Ô∏è Screen reader issues found:</p><ul>' + 
                    issues.map(issue => `<li>${issue}</li>`).join('') + '</ul>';
            }
        }

        // Run all tests
        setTimeout(() => {
            validateTouchTargets();
            validateARIA();
            checkContrast();
            validateFocus();
            validateScreenReader();
        }, 100);

        // Export results function
        function exportResults() {
            const results = {
                timestamp: new Date().toISOString(),
                touchTargets: document.getElementById('target-results').textContent,
                aria: document.getElementById('aria-results').textContent,
                contrast: document.getElementById('contrast-results').textContent,
                focus: document.getElementById('focus-results').textContent,
                screenReader: document.getElementById('sr-results').textContent
            };
            
            const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `strideguide-a11y-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Add export button
        const exportBtn = document.createElement('button');
        exportBtn.textContent = 'Export Results';
        exportBtn.onclick = exportResults;
        exportBtn.style.cssText = 'position: fixed; top: 20px; right: 20px; padding: 10px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;';
        document.body.appendChild(exportBtn);
    </script>
</body>
</html>